# BM25 é›†æˆæ–¹æ¡ˆæ€»ç»“

## ğŸ“‹ å®ç°æ¦‚è¿°

æˆåŠŸä¸º LangGraphGo å®ç°äº†å®Œæ•´çš„ BM25 (Best Matching 25) ç¨€ç–æ£€ç´¢å™¨ï¼Œå‚è€ƒäº† LangChain Python çš„ BM25 é›†æˆæ–¹æ¡ˆã€‚

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. BM25 æ£€ç´¢å™¨ (`rag/retriever/bm25.go`)
- å®Œæ•´çš„ BM25 æ’åºç®—æ³•å®ç°
- å¯é…ç½®çš„ k1 å’Œ b å‚æ•°
- æ”¯æŒåŠ¨æ€æ–‡æ¡£ç®¡ç†ï¼ˆæ·»åŠ ã€æ›´æ–°ã€åˆ é™¤ï¼‰
- å€’æ’ç´¢å¼•å®ç°
- åˆ†æ•°é˜ˆå€¼è¿‡æ»¤

### 2. åˆ†è¯å™¨ (`rag/tokenizer/tokenizer.go`)
- `SimpleTokenizer`: åŸºç¡€å•è¯çº§åˆ†è¯
- `RegexTokenizer`: æ­£åˆ™è¡¨è¾¾å¼åˆ†è¯
- `NgramTokenizer`: N-gram åˆ†è¯
- `ChineseTokenizer`: ä¸­æ–‡åˆ†è¯æ”¯æŒ

### 3. ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ
- å®ç°äº† `rag.Retriever` æ¥å£
- å¯ä¸ `HybridRetriever` ç»“åˆä½¿ç”¨
- æ”¯æŒ `rag.RetrievalConfig` é…ç½®

## ğŸ“ æ–‡ä»¶ç»“æ„

```
langgraphgo/
â”œâ”€â”€ rag/
â”‚   â”œâ”€â”€ retriever/
â”‚   â”‚   â”œâ”€â”€ bm25.go              # BM25 retriever å®ç°
â”‚   â”‚   â””â”€â”€ bm25_test.go         # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ tokenizer/
â”‚   â”‚   â””â”€â”€ tokenizer.go         # åˆ†è¯å™¨å®ç°
â”‚   â””â”€â”€ examples/
â”‚       â””â”€â”€ bm25_example.go      # ä½¿ç”¨ç¤ºä¾‹
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ bm25_demo/
â”‚       â””â”€â”€ main.go              # å®Œæ•´æ¼”ç¤ºç¨‹åº
â””â”€â”€ docs/
    â””â”€â”€ bm25_integration.md      # è¯¦ç»†æ–‡æ¡£
```

## ğŸš€ ä½¿ç”¨æ–¹å¼

### åŸºç¡€ç”¨æ³•

```go
import "github.com/smallnest/langgraphgo/rag/retriever"

// åˆ›å»ºæ–‡æ¡£
docs := []rag.Document{
    {ID: "doc1", Content: "æ–‡æ¡£å†…å®¹1"},
    {ID: "doc2", Content: "æ–‡æ¡£å†…å®¹2"},
}

// åˆ›å»º BM25 æ£€ç´¢å™¨
config := retriever.DefaultBM25Config()
config.K = 3
bm25Retriever, _ := retriever.NewBM25Retriever(docs, config)

// æŸ¥è¯¢
ctx := context.Background()
results, _ := bm25Retriever.Retrieve(ctx, "æŸ¥è¯¢å…³é”®è¯")
```

### æ··åˆæ£€ç´¢ï¼ˆBM25 + å‘é‡ï¼‰

```go
// BM25 æ£€ç´¢å™¨ï¼ˆç¨€ç–ï¼‰
bm25Retriever, _ := retriever.NewBM25Retriever(docs, config)

// å‘é‡æ£€ç´¢å™¨ï¼ˆå¯†é›†ï¼‰
vectorRetriever := retriever.NewVectorRetriever(store, embedder, config)

// æ··åˆæ£€ç´¢å™¨
hybridRetriever := retriever.NewHybridRetriever(
    []rag.Retriever{bm25Retriever, vectorRetriever},
    []float64{0.5, 0.5},
    rag.RetrievalConfig{K: 5},
)

results, _ := hybridRetriever.Retrieve(ctx, "æŸ¥è¯¢")
```

## ğŸ”§ å‚æ•°è°ƒä¼˜

### k1 å‚æ•°
- æ§åˆ¶è¯é¢‘é¥±å’Œåº¦
- èŒƒå›´ï¼š1.2 - 2.0
- é«˜ k1 = æ›´é‡è§†è¯é¢‘
- çŸ­æŸ¥è¯¢ä½¿ç”¨è¾ƒé«˜ k1ï¼ˆå¦‚ 2.0ï¼‰
- é•¿æŸ¥è¯¢ä½¿ç”¨è¾ƒä½ k1ï¼ˆå¦‚ 1.2ï¼‰

### b å‚æ•°
- æ§åˆ¶æ–‡æ¡£é•¿åº¦å½’ä¸€åŒ–
- èŒƒå›´ï¼š0.0 - 1.0
- 0 = ä¸å½’ä¸€åŒ–ï¼Œ1 = å®Œå…¨å½’ä¸€åŒ–
- æ¨èå€¼ï¼š0.75

## âœ… æµ‹è¯•è¦†ç›–

æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼š
- âœ… åŸºç¡€æ£€ç´¢
- âœ… è‡ªå®šä¹‰ K å€¼
- âœ… åˆ†æ•°é˜ˆå€¼è¿‡æ»¤
- âœ… åŠ¨æ€æ·»åŠ æ–‡æ¡£
- âœ… æ›´æ–°æ–‡æ¡£
- âœ… åˆ é™¤æ–‡æ¡£
- âœ… è‡ªå®šä¹‰åˆ†è¯å™¨
- âœ… å‚æ•°è°ƒä¼˜
- âœ… ç»Ÿè®¡ä¿¡æ¯

## ğŸ“Š æ€§èƒ½ç‰¹ç‚¹

| ç‰¹æ€§ | BM25 | å‘é‡æ£€ç´¢ |
|------|------|----------|
| æ£€ç´¢ç±»å‹ | ç¨€ç–ï¼ˆå…³é”®è¯ï¼‰ | å¯†é›†ï¼ˆè¯­ä¹‰ï¼‰ |
| ç´¢å¼•å¤§å° | å° | å¤§ |
| æŸ¥è¯¢é€Ÿåº¦ | å¿« | è¾ƒæ…¢ |
| ç²¾ç¡®åŒ¹é… | ä¼˜ç§€ | è¾ƒå¼± |
| è¯­ä¹‰ç†è§£ | è¾ƒå¼± | ä¼˜ç§€ |

## ğŸ¨ è®¾è®¡äº®ç‚¹

1. **æ¥å£ä¸€è‡´æ€§**: å®Œå…¨å®ç°äº† `rag.Retriever` æ¥å£ï¼Œå¯æ— ç¼æ›¿æ¢
2. **æ‰©å±•æ€§**: æ”¯æŒè‡ªå®šä¹‰åˆ†è¯å™¨
3. **å›½é™…åŒ–**: å†…ç½®ä¸­æ–‡åˆ†è¯æ”¯æŒ
4. **æ··åˆèƒ½åŠ›**: å¯ä¸ç°æœ‰å‘é‡æ£€ç´¢å™¨ç»„åˆ
5. **çº¿ç¨‹å®‰å…¨**: å€’æ’ç´¢å¼•æ”¯æŒå¹¶å‘è¯»å–

## ğŸ“š æ–‡æ¡£

- è¯¦ç»†ä½¿ç”¨æ–‡æ¡£: `docs/bm25_integration.md`
- å®Œæ•´ç¤ºä¾‹: `examples/bm25_demo/main.go`
- ä»£ç ç¤ºä¾‹: `rag/examples/bm25_example.go`

## ğŸ”— ä¸ LangChain Python å¯¹æ¯”

| åŠŸèƒ½ | LangGraphGo | LangChain Python |
|------|-------------|------------------|
| BM25 ç®—æ³• | âœ… å®Œæ•´å®ç° | âœ… |
| å‚æ•°è°ƒä¼˜ | âœ… | âœ… |
| è‡ªå®šä¹‰åˆ†è¯ | âœ… | âœ… |
| ä¸­æ–‡æ”¯æŒ | âœ… å†…ç½® | éœ€å¤–éƒ¨åº“ |
| æ··åˆæ£€ç´¢ | âœ… åŸç”Ÿæ”¯æŒ | éœ€æ‰‹åŠ¨å®ç° |
| åŠ¨æ€æ›´æ–° | âœ… | âœ… |
| çº¿ç¨‹å®‰å…¨ | âœ… | âŒ (GILé™åˆ¶) |

## ğŸ¯ ä½¿ç”¨åœºæ™¯

1. **ç²¾ç¡®å…³é”®è¯æœç´¢**: ç”¨æˆ·æŸ¥è¯¢ç‰¹å®šæœ¯è¯­
2. **æ··åˆæ£€ç´¢**: ç»“åˆè¯­ä¹‰å’Œå…³é”®è¯åŒ¹é…
3. **å¤šè¯­è¨€æ”¯æŒ**: è‹±æ–‡ã€ä¸­æ–‡ç­‰å¤šç§è¯­è¨€
4. **åŠ¨æ€ç´¢å¼•**: æ–‡æ¡£é¢‘ç¹å˜åŒ–çš„åœºæ™¯
5. **å¿«é€ŸåŸå‹**: æ— éœ€å‘é‡æ•°æ®åº“çš„å¿«é€Ÿæ£€ç´¢

## ğŸ“ˆ åç»­ä¼˜åŒ–å»ºè®®

1. **å‹ç¼©ç´¢å¼•**: ä½¿ç”¨å‹ç¼©æŠ€æœ¯å‡å°‘å†…å­˜å ç”¨
2. **æŒä¹…åŒ–**: æ”¯æŒç´¢å¼•ä¿å­˜å’ŒåŠ è½½
3. **åˆ†å¸ƒå¼**: æ”¯æŒåˆ†å¸ƒå¼ç´¢å¼•
4. **æŸ¥è¯¢æ‰©å±•**: è‡ªåŠ¨æ‰©å±•æŸ¥è¯¢è¯
5. **å­¦ä¹ æ’åº**: ç»“åˆæœºå™¨å­¦ä¹ ä¼˜åŒ–æ’åº

---

**å®ç°æ—¥æœŸ**: 2026-01-18
**å‚è€ƒæ–‡æ¡£**: https://docs.langchain.com/oss/python/integrations/retrievers/bm25
**æµ‹è¯•çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡
**ä»£ç è´¨é‡**: âœ… gofmt, go vet, golangci-lint å…¨éƒ¨é€šè¿‡
