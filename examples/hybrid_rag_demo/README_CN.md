# æ··åˆ RAG æ¼”ç¤º - BM25 + VectorDB

æœ¬ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªå®Œæ•´çš„**æ··åˆ RAG (æ£€ç´¢å¢å¼ºç”Ÿæˆ)** ç³»ç»Ÿï¼Œç»“åˆäº†ï¼š

- **BM25**: ç¨€ç–å…³é”®å­—æ£€ç´¢ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰
- **VectorDB**: å¯†é›†è¯­ä¹‰æ£€ç´¢ï¼ˆç›¸ä¼¼åº¦åŒ¹é…ï¼‰
- **æ··åˆæœç´¢**: ç»“åˆä¸¤ç§æ–¹æ³•ä»¥è·å¾—æœ€ä½³ç»“æœ

## ğŸ¯ æœ¬æ¼”ç¤ºå†…å®¹

1. **å¹¶æ’å¯¹æ¯”** BM25ã€å‘é‡å’Œæ··åˆæ£€ç´¢
2. **å®Œæ•´çš„ RAG æµç¨‹**ï¼ŒåŒ…æ‹¬ä¸Šä¸‹æ–‡æ„å»ºå’Œå“åº”ç”Ÿæˆ
3. **æƒé‡è°ƒä¼˜**ä»¥æ‰¾åˆ°æ£€ç´¢æ–¹æ³•ä¹‹é—´çš„æœ€ä½³å¹³è¡¡
4. æ¥è‡ªä¸¤ä¸ªæ£€ç´¢ç³»ç»Ÿçš„**ç»Ÿè®¡ä¿¡æ¯å’Œæ´å¯Ÿ**

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ¼”ç¤º

```bash
cd examples/hybrid_rag_demo
go run main.go
```

æˆ–æ„å»ºå¹¶è¿è¡Œï¼š

```bash
go build -o hybrid_rag main.go
./hybrid_rag
```

## ğŸ“Š è¾“å‡ºç¤ºä¾‹

```
=== æ··åˆ RAG æ¼”ç¤º (BM25 + VectorDB) ===

æœ¬æ¼”ç¤ºç»“åˆäº†:
  ğŸ“Š BM25: ç¨€ç–å…³é”®å­—æ£€ç´¢
  ğŸ” Vector: å¯†é›†è¯­ä¹‰æ£€ç´¢
  ğŸ”€ Hybrid: ä¸¤è€…ç»“åˆ!

1. åŠ è½½ç¤ºä¾‹æ–‡æ¡£...
   âœ“ å·²åŠ è½½ 10 ä¸ªæ–‡æ¡£

...

æŸ¥è¯¢: "LangGraph framework agents"
----------------------------------------------------------------------
ğŸ“Š BM25 (å…³é”®å­—):    [doc1] [doc9] [doc2]
ğŸ” Vector (è¯­ä¹‰):    [doc3] [doc1] [doc5]
ğŸ”€ Hybrid (ç»„åˆ):    [doc1] [doc9] [doc3]
```

## ğŸ”§ å·¥ä½œåŸç†

### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ··åˆ RAG ç³»ç»Ÿ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ç”¨æˆ·æŸ¥è¯¢ â”€â”€â”¬â”€â”€> ğŸ“Š BM25 æ£€ç´¢å™¨ â”€â”€â”                         â”‚
â”‚            â”‚                        â”‚                       â”‚
â”‚            â”œâ”€â”€> ğŸ” å‘é‡æ£€ç´¢å™¨ â”€â”€â”€â”€â”¼â”€â”€> ğŸ”€ åˆå¹¶              â”‚
â”‚            â”‚                        â”‚   åˆ†æ•°               â”‚
â”‚            â”‚                        â”‚                       â”‚
â”‚            â””â”€â”€> ğŸ¯ æƒé‡ (40/60) â”€â”€â”˜                         â”‚
â”‚                                    â”‚                        â”‚
â”‚                                    â–¼                        â”‚
â”‚  ğŸ“š Top-K ç›¸å…³æ–‡æ¡£ â”€â”€> ğŸ“ ä¸Šä¸‹æ–‡æ„å»º                        â”‚
â”‚                                    â”‚                        â”‚
â”‚                                    â–¼                        â”‚
â”‚  ğŸ¤– LLM ç”Ÿæˆ â”€â”€> ğŸ’¬ æœ€ç»ˆå“åº”                                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»£ç ç»“æ„

```go
// 1. åŠ è½½æ–‡æ¡£
docs := loadSampleDocuments()

// 2. åˆ›å»ºåµŒå…¥å™¨
embedder := store.NewMockEmbedder(1536)

// 3. åˆ›å»ºå‘é‡å­˜å‚¨
vectorStore := store.NewInMemoryVectorStore(embedder)
vectorStore.Add(ctx, docs)

// 4. åˆ›å»º BM25 æ£€ç´¢å™¨ï¼ˆç¨€ç–ï¼‰
bm25Retriever, _ := retriever.NewBM25Retriever(docs, config)

// 5. åˆ›å»ºå‘é‡æ£€ç´¢å™¨ï¼ˆå¯†é›†ï¼‰
vectorRetriever := retriever.NewVectorRetriever(vectorStore, embedder, config)

// 6. åˆ›å»ºæ··åˆæ£€ç´¢å™¨
hybridRetriever := retriever.NewHybridRetriever(
    []rag.Retriever{bm25Retriever, vectorRetriever},
    []float64{0.4, 0.6},  // BM25: 40%, Vector: 60%
    rag.RetrievalConfig{K: 5},
)

// 7. æ£€ç´¢å¹¶ç”Ÿæˆ
results, _ := hybridRetriever.Retrieve(ctx, query)
context := buildContext(results)
response := generateResponse(ctx, llm, query, context)
```

## ğŸ“ˆ ä½•æ—¶ä½¿ç”¨å“ªç§æ–¹æ³•

### BM25ï¼ˆç¨€ç–æ£€ç´¢ï¼‰
- âœ… **æœ€é€‚åˆ**: ç²¾ç¡®å…³é”®å­—åŒ¹é…ã€æŠ€æœ¯æœ¯è¯­ã€äº§å“åç§°
- âœ… **ä½¿ç”¨åœºæ™¯**:
  - æœç´¢ç‰¹å®šæŠ€æœ¯æ–‡æ¡£
  - äº§å“/é›¶ä»¶å·æŸ¥æ‰¾
  - ç²¾ç¡®çŸ­è¯­åŒ¹é…
  - èµ„æºå—é™ç¯å¢ƒ

### Vectorï¼ˆå¯†é›†æ£€ç´¢ï¼‰
- âœ… **æœ€é€‚åˆ**: è¯­ä¹‰ç†è§£ã€æ¦‚å¿µã€åŒä¹‰è¯
- âœ… **ä½¿ç”¨åœºæ™¯**:
  - æ¦‚å¿µæ€§æŸ¥è¯¢ï¼ˆ"X æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"ï¼‰
  - åŒä¹‰è¯å¤„ç†ï¼ˆ"æ±½è½¦" vs "è½¿è½¦"ï¼‰
  - å¤šè¯­è¨€æœç´¢
  - æ¨èç³»ç»Ÿ

### Hybridï¼ˆç»„åˆï¼‰
- âœ… **æœ€é€‚åˆ**: ç»“åˆå…³é”®å­—ç²¾ç¡®æ€§å’Œè¯­ä¹‰ç†è§£
- âœ… **ä½¿ç”¨åœºæ™¯**:
  - ä¼ä¸šæœç´¢
  - çŸ¥è¯†ç®¡ç†
  - å®¢æˆ·æ”¯æŒç³»ç»Ÿ
  - RAG åº”ç”¨

## âš–ï¸ è°ƒæ•´æƒé‡

æ··åˆæ£€ç´¢å™¨ä½¿ç”¨æƒé‡åœ¨ BM25 å’Œå‘é‡ç»“æœä¹‹é—´è¿›è¡Œå¹³è¡¡ï¼š

```go
// æŠ€æœ¯æ–‡æ¡£ - å¼ºè°ƒ BM25
hybridRetriever := retriever.NewHybridRetriever(
    []rag.Retriever{bm25Retriever, vectorRetriever},
    []float64{0.6, 0.4},  // BM25: 60%, Vector: 40%
    config,
)

// é€šç”¨çŸ¥è¯† - å¼ºè°ƒå‘é‡
hybridRetriever := retriever.NewHybridRetriever(
    []rag.Retriever{bm25Retriever, vectorRetriever},
    []float64{0.3, 0.7},  // BM25: 30%, Vector: 70%
    config,
)

// å¹³è¡¡æ–¹æ³•
hybridRetriever := retriever.NewHybridRetriever(
    []rag.Retriever{bm25Retriever, vectorRetriever},
    []float64{0.5, 0.5},  // BM25: 50%, Vector: 50%
    config,
)
```

### æƒé‡è°ƒä¼˜æŒ‡å—

| åœºæ™¯ | BM25 æƒé‡ | Vector æƒé‡ |
|------|-----------|-------------|
| æŠ€æœ¯æ–‡æ¡£ | 0.6-0.7 | 0.3-0.4 |
| æ³•å¾‹/åŒ»å­¦æ–‡æœ¬ | 0.5 | 0.5 |
| é€šç”¨çŸ¥è¯† | 0.3-0.4 | 0.6-0.7 |
| ç”µå•†äº§å“æœç´¢ | 0.7 | 0.3 |
| å®¢æˆ·æ”¯æŒ | 0.4-0.5 | 0.5-0.6 |

## ğŸ” å¯¹æ¯”ç»“æœ

æ¼”ç¤ºè¿è¡Œä¸‰ç§ç±»å‹çš„æŸ¥è¯¢ä»¥å±•ç¤ºæ¯ç§æ–¹æ³•çš„ä¼˜åŠ¿ï¼š

1. **æŠ€æœ¯æœ¯è¯­** ("LangGraph framework agents")
   - BM25 æ“…é•¿æŸ¥æ‰¾ç²¾ç¡®çš„å…³é”®å­—åŒ¹é…

2. **é€šç”¨æ¦‚å¿µ** ("machine learning algorithms")
   - å‘é‡æ£€ç´¢æ•è·è¯­ä¹‰å…³ç³»

3. **æ··åˆæŸ¥è¯¢** ("programming languages comparison")
   - æ··åˆç»“åˆä¸¤ç§æ–¹æ³•è·å¾—æœ€ä½³ç»“æœ

## ğŸ“¦ è‡ªå®šä¹‰

### ä½¿ç”¨è‡ªå·±çš„æ–‡æ¡£

```go
func loadMyDocuments() []rag.Document {
    return []rag.Document{
        {
            ID:      "doc1",
            Content: "æ‚¨çš„æ–‡æ¡£å†…å®¹...",
            Metadata: map[string]any{
                "title": "æ–‡æ¡£æ ‡é¢˜",
                "source": "file.pdf",
            },
        },
        // ... æ›´å¤šæ–‡æ¡£
    }
}
```

### ä½¿ç”¨çœŸå®çš„å‘é‡å­˜å‚¨

å°†å†…å­˜å­˜å‚¨æ›¿æ¢ä¸ºæŒä¹…åŒ–å­˜å‚¨ï¼š

```go
// ChromaDB
import "github.com/smallnest/langgraphgo/rag/store"

vectorStore, err := store.NewChromaVectorStore(
    store.ChromaConfig{
        Host: "localhost",
        Port: 8000,
    },
    embedder,
)

// æˆ–ä½¿ç”¨ PostgreSQLã€Redis ç­‰
```

### ä½¿ç”¨çœŸå®çš„åµŒå…¥å™¨

å°† mock åµŒå…¥å™¨æ›¿æ¢ä¸º OpenAIï¼š

```go
import "github.com/tmc/langchaingo/embeddings"
import "github.com/tmc/langchaingo/llms/openai"

llm, _ := openai.New()
embedder, _ := embeddings.NewEmbedder(llm)
```

### ä½¿ç”¨çœŸå®çš„ LLM ç”Ÿæˆ

```go
import "github.com/tmc/langchaingo/llms/openai"

func generateResponse(ctx context.Context, llm llms.Model, query, context string) (string, error) {
    prompt := fmt.Sprintf(`
ä¸Šä¸‹æ–‡:
%s

é—®é¢˜: %s

æ ¹æ®ä»¥ä¸Šä¸Šä¸‹æ–‡å›ç­”é—®é¢˜ã€‚
`, context, query)

    return llms.GenerateFromSinglePrompt(ctx, llm, prompt)
}
```

## ğŸ“ æ ¸å¿ƒæ¦‚å¿µ

### ç¨€ç– vs å¯†é›†æ£€ç´¢

**ç¨€ç–æ£€ç´¢ (BM25)**:
- å°†æ–‡æ¡£è¡¨ç¤ºä¸ºè¯é¢‘çš„ç¨€ç–å‘é‡
- åªè€ƒè™‘å‡ºç°åœ¨æŸ¥è¯¢ä¸­çš„æœ¯è¯­
- é«˜æ•ˆçš„ç²¾ç¡®å…³é”®å­—åŒ¹é…
- è¾ƒä½çš„å†…å­˜å ç”¨

**å¯†é›†æ£€ç´¢ (Vector)**:
- å°†æ–‡æ¡£è¡¨ç¤ºä¸ºå¯†é›†çš„åµŒå…¥å‘é‡
- æ•è·è¯­ä¹‰å…³ç³»
- å¤„ç†åŒä¹‰è¯å’Œç›¸å…³æ¦‚å¿µ
- æ›´é«˜ç»´åº¦çš„è¡¨ç¤º

### æ··åˆåˆ†æ•°èåˆ

æ··åˆæ£€ç´¢å™¨ç»„åˆæ¥è‡ªä¸¤ç§æ–¹æ³•çš„åˆ†æ•°ï¼š

```
æœ€ç»ˆåˆ†æ•° = w1 * bm25åˆ†æ•° + w2 * å‘é‡åˆ†æ•°

å…¶ä¸­:
- w1, w2 æ˜¯æ€»å’Œä¸º 1.0 çš„æƒé‡
- bm25åˆ†æ•° æ˜¯å½’ä¸€åŒ–çš„ BM25 ç›¸å…³æ€§
- å‘é‡åˆ†æ•° æ˜¯ä½™å¼¦ç›¸ä¼¼åº¦
```

### å¤šæºæå‡

ç”±å¤šä¸ªæ–¹æ³•æ£€ç´¢çš„æ–‡æ¡£ä¼šè·å¾—æå‡ï¼š

```go
if è¢«BM25æ£€ç´¢ && è¢«å‘é‡æ£€ç´¢ {
    æœ€ç»ˆåˆ†æ•° *= 1.1  // 10% æå‡
}
```

## ğŸ“Š æ€§èƒ½è€ƒè™‘

### å†…å­˜ä½¿ç”¨

| ç»„ä»¶ | å†…å­˜ (1ä¸‡æ–‡æ¡£) | å†…å­˜ (10ä¸‡æ–‡æ¡£) |
|------|---------------|-----------------|
| BM25 ç´¢å¼• | ~10-50 MB | ~100-500 MB |
| å‘é‡å­˜å‚¨ (1536ç»´) | ~60 MB | ~600 MB |
| æ··åˆ (ä¸¤è€…) | ~70-100 MB | ~700-1100 MB |

### æŸ¥è¯¢å»¶è¿Ÿ

| æ–¹æ³• | å»¶è¿Ÿ (1ä¸‡æ–‡æ¡£) | å»¶è¿Ÿ (10ä¸‡æ–‡æ¡£) |
|------|---------------|-----------------|
| BM25 | ~10-50ms | ~50-200ms |
| Vector | ~50-100ms | ~200-500ms |
| Hybrid | ~60-150ms | ~250-700ms |

*æ³¨æ„ï¼šå®é™…æ€§èƒ½å–å†³äºç¡¬ä»¶å’Œå®ç°*

## ğŸ”— ç›¸å…³ç¤ºä¾‹

- [BM25 æ¼”ç¤º](../bm25_demo/) - ä»… BM25 æ£€ç´¢
- [Vector RAG æ¼”ç¤º](../rag_demo/) - ä»…å‘é‡ RAG

## ğŸ“š å»¶ä¼¸é˜…è¯»

- [BM25 é›†æˆæ–‡æ¡£](../../docs/bm25_integration.md)
- [RAG æµç¨‹æŒ‡å—](../../docs/rag_pipeline.md)
- [æ··åˆæœç´¢æœ€ä½³å®è·µ](../../docs/hybrid_search.md)

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼å¯ä»¥æ”¹è¿›çš„é¢†åŸŸï¼š

- åœ¨æ··åˆæ£€ç´¢åæ·»åŠ é‡æ’åºæ­¥éª¤
- å®ç°æŸ¥è¯¢æ‰©å±•
- ä¸ºé‡å¤æŸ¥è¯¢æ·»åŠ ç¼“å­˜
- æ”¯æŒæ›´å¤šå‘é‡å­˜å‚¨
- åŸºå‡†æµ‹è¯•å¥—ä»¶

## ğŸ“„ è®¸å¯è¯

LangGraphGo é¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚è¯¦è§ä¸» LICENSE æ–‡ä»¶ã€‚

## ğŸ¯ æ€»ç»“

æœ¬æ··åˆ RAG æ¼”ç¤ºå±•ç¤ºäº†ç»“åˆç¨€ç– (BM25) å’Œå¯†é›† (å‘é‡) æ£€ç´¢å¦‚ä½•æä¾›æ¯”å•ç‹¬ä½¿ç”¨ä»»ä½•ä¸€ç§æ–¹æ³•æ›´å¥½çš„ç»“æœã€‚å…³é”®æ˜¯é€šè¿‡å®éªŒå’ŒéªŒè¯ä¸ºæ‚¨çš„ç”¨ä¾‹æ‰¾åˆ°æ­£ç¡®çš„æƒé‡å¹³è¡¡ã€‚

---

**æ ¸å¿ƒè¦ç‚¹**: æ··åˆæ£€ç´¢ = å…³é”®å­—ç²¾ç¡®æ€§ (BM25) + è¯­ä¹‰ç†è§£ (Vector) = æœ€ä½³æœç´¢ç»“æœ ğŸ¯
